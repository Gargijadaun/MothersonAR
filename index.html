<!DOCTYPE html>
<html>
  <head>
    <title>Plane Detection AR Video</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-ar-hit-test@1.1.1/dist/aframe-ar-hit-test.min.js"></script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <a-scene
      webxr="optionalFeatures: hit-test;"
      vr-mode-ui="enabled: false"
      ar-hit-test="target: #videoPlane"
      embedded
      renderer="colorManagement: true; physicallyCorrectLights: true;"
    >
      <!-- Assets -->
      <a-assets>
        <video id="videoAsset" src="./assets/video/Video1.mp4" loop playsinline crossorigin="anonymous"></video>
      </a-assets>

      <!-- AR Camera -->
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- Video Plane (Initially Hidden) -->
      <a-video
        id="videoPlane"
        src="#videoAsset"
        width="1"
        height="0.56"
        rotation="-90 0 0"
        visible="false"
      ></a-video>

      <!-- Reticle (Hit test indicator) -->
      <a-entity
        id="reticle"
        ar-hit-test-target
        geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.07;"
        material="color: yellow; shader: flat"
        position="0 0 0"
        rotation="-90 0 0"
        visible="false"
      ></a-entity>
    </a-scene>

    <script>
      const videoPlane = document.getElementById('videoPlane');
      const video = document.getElementById('videoAsset');
      const scene = document.querySelector('a-scene');
      const reticle = document.getElementById('reticle');

      // Show reticle when hit test finds surface
      scene.addEventListener('ar-hit-test-select', function () {
        if (!videoPlane.getAttribute('visible')) {
          // Place video on the surface
          const position = reticle.getAttribute('position');
          videoPlane.setAttribute('position', position);
          videoPlane.setAttribute('visible', true);
          video.play();
        }
      });

      // Reticle visibility control
      scene.addEventListener('ar-hit-test-available', () => {
        reticle.setAttribute('visible', true);
      });

      scene.addEventListener('ar-hit-test-unavailable', () => {
        reticle.setAttribute('visible', false);
      });
    </script>
  </body>
</html>
